# 全体的な注意点
* コードはなるべく変更しないように、必要最小限の修正になるようにしてください。もし大きい修正が必要な場合はユーザーに確認してください
* コードはなるべくコンポーネント毎に分けるようにしてください


# TTSアプリケーション処理フロー図解

## 1. 基本アーキテクチャ

```
[React UI層]
    ↓ ↑
[TtsContext (状態管理)]
    ↓ ↑
[preload.js (IPC通信)]
    ↓ ↑
[main.js (メインプロセス)]
    ↓ ↑
[tts-service.js (TTS処理)]
```

## 2. 具体的な処理フロー

### 2.1 音声生成・再生の開始フロー
1. TtsPlayerコンポーネントでユーザーがアクション実行
2. TtsContextのstartSpeaking関数が呼び出される
3. electron.tts.playAudioがpreload.jsを介して実行
4. main.jsでipcMain.handleが'tts-play-audio'を受信
5. tts-service.jsのplayAudio関数が実行され、音声生成と再生を開始

### 2.2 イベント通知フロー（逆方向）
1. tts-service.jsでイベント発生（進捗など）
2. EventEmitterを通じてmain.jsに通知
3. main.jsからwebContents.sendでレンダラーに通知
4. preload.jsのイベントリスナーが受信
5. TtsContextのイベントハンドラーが実行
6. React UIが更新される

## 3. 主要コンポーネントの役割

### 3.1 TtsPlayer (React Component)
- ユーザーインターフェースの提供
- 再生コントロール（開始、一時停止、停止など）
- 進捗表示

### 3.2 TtsContext (React Context)
- TTSの状態管理
- イベントハンドラーの管理
- 操作関数の提供

### 3.3 preload.js (IPC Bridge)
- メインプロセスとレンダラープロセス間の安全な通信
- APIの公開（electron.tts）

### 3.4 main.js (Main Process)
- Electronのメイン処理
- IPCハンドラーの設定
- TTSサービスの初期化

### 3.5 tts-service.js (Core TTS Service)
- 音声生成処理
- 音声再生制御
- 動画生成処理
- YouTube連携

## 4. 主要な機能と実装の詳細

### 4.1 音声生成プロセス
1. テキストを適切な長さに分割
2. 各セグメントに対して：
   - 音声クエリの作成
   - 話者モデルの初期化
   - 音声の合成
   - 一時ファイルとして保存

### 4.2 音声再生制御
1. 生成された音声ファイルの管理
2. 再生速度の制御
3. 一時停止/再開の制御
4. 次へ/前への移動制御

### 4.3 進捗管理
1. 音声生成の進捗通知
2. 再生進捗の通知
3. 動画生成の進捗通知
4. YouTube投稿の進捗通知

### 4.4 動画生成処理
1. 音声ファイルの結合
2. 背景画像の設定
3. テキストのオーバーレイ
4. BGMの追加

### 4.5 YouTube連携
1. 認証処理
2. メタデータの設定
3. 動画のアップロード
4. 進捗モニタリング
